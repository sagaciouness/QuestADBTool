<Window x:Class="QuestADBTool.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Quest 安装与输入工具" Height="600" Width="900"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource Bg}" TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType" UseLayoutRounding="True" SnapsToDevicePixels="True">

    <Grid UseLayoutRounding="True" SnapsToDevicePixels="True" Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Style="{StaticResource CardBorder}">
            <DockPanel LastChildFill="True">
                <Border Background="#F8FAFC" BorderBrush="#E2E8F0" BorderThickness="1" CornerRadius="8" Padding="10,8">
                    <StackPanel Orientation="Vertical">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Ellipse x:Name="StatusDot" Width="10" Height="10" Fill="#9CA3AF" Margin="0,0,8,0" VerticalAlignment="Center"/>
                            <TextBlock Text="设备连接" FontSize="14" FontWeight="SemiBold"/>
                        </StackPanel>
                        <TextBlock x:Name="StatusText" Text="正在检测..." Foreground="{StaticResource TextDim}" Margin="0,6,0,0"/>
                    </StackPanel>
                </Border>

                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button Content="重新检测" Margin="10,0,0,0" Click="Refresh_Click" Style="{DynamicResource FluentButton}" x:Name="RefreshButton" />
                    <Button Content="新手引导" Margin="10,0,0,0" Click="Guide_Click" ToolTip="打开新手使用说明（可随时查看）" Style="{DynamicResource FluentButton}" x:Name="GuideButton" />
                    <Button Content="修复连接" Margin="10,0,0,0" Click="RestartAdb_Click" Style="{DynamicResource FluentButton}" x:Name="RestartButton" />
                    <Button Content="打开问题日志" Margin="10,0,0,0" Click="OpenLog_Click" Style="{DynamicResource FluentButton}" x:Name="OpenLogButton" />
                </StackPanel>
            </DockPanel>
        </Border>

        <TextBlock x:Name="BusyText" Text="" Foreground="{DynamicResource TextDim}"
                   HorizontalAlignment="Right" Margin="0,8,0,0" Visibility="Collapsed"/>

        <Border x:Name="InstallCardBorder" Grid.Row="1" Style="{StaticResource CardBorder}" Margin="0,14,0,0"
                AllowDrop="True"
                PreviewDragOver="InstallArea_PreviewDragOver"
                DragLeave="InstallArea_DragLeave"
                Drop="InstallArea_Drop">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1.35*"/>
                    <ColumnDefinition Width="0.95*"/>
                </Grid.ColumnDefinitions>

                <DockPanel Grid.Row="0" Grid.ColumnSpan="2" LastChildFill="False">
                    <TextBlock Text="安装应用到 Quest" FontSize="14" FontWeight="SemiBold"/>
                    <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Border Background="#ECFDF5" BorderBrush="#BBF7D0" BorderThickness="1" CornerRadius="6" Padding="10,3" Margin="8,0,0,0">
                            <TextBlock x:Name="InstallSuccessBadge" Text="成功 0" Foreground="#166534" FontSize="12"/>
                        </Border>
                        <Border Background="#FEF2F2" BorderBrush="#FECACA" BorderThickness="1" CornerRadius="6" Padding="10,3" Margin="8,0,0,0">
                            <TextBlock x:Name="InstallFailBadge" Text="失败 0" Foreground="#991B1B" FontSize="12"/>
                        </Border>
                    </StackPanel>
                </DockPanel>

                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,10,12,0">
                    <TextBlock Text="选择 .apk 文件后点击“安装应用”" Foreground="{StaticResource TextDim}" Margin="0,0,0,10"/>

                    <Border Margin="0,0,0,10" Padding="10,8" CornerRadius="8" BorderThickness="1"
                            Background="#F8FAFC" BorderBrush="#CBD5E1">
                        <TextBlock Text="可直接将 .apk 文件拖入此区域（或路径输入框）自动开始安装"
                                   Foreground="{DynamicResource TextDim}"/>
                    </Border>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBox x:Name="ApkPathBox" Height="36" VerticalContentAlignment="Center"
                                 TextChanged="ApkPathBox_TextChanged"
                                 AllowDrop="True"
                                 PreviewDragOver="InstallArea_PreviewDragOver"
                                 DragLeave="InstallArea_DragLeave"
                                 Drop="InstallArea_Drop"/>

                        <Button Grid.Column="1" Margin="10,0,0,0" Click="PickApk_Click" Style="{DynamicResource FluentButton}" x:Name="PickApkButton">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE8B7;" Margin="0,0,6,0"/>
                                <TextBlock Text="选择..."/>
                            </StackPanel>
                        </Button>

                        <Button x:Name="InstallApkButton" Grid.Column="2" Margin="10,0,0,0" Click="InstallApk_Click" Style="{DynamicResource PrimaryButton}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock FontFamily="Segoe MDL2 Assets" Text="&#xE898;" Margin="0,0,6,0"/>
                                <TextBlock Text="安装应用"/>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <StackPanel x:Name="InstallProgressPanel" Orientation="Vertical" Margin="0,10,0,0" Visibility="Collapsed">
                        <ProgressBar x:Name="InstallProgressBar" Height="8" IsIndeterminate="True"/>
                        <TextBlock x:Name="InstallProgressText" Text="准备安装..." Foreground="{StaticResource TextDim}" Margin="0,6,0,0"/>
                    </StackPanel>

                    <TextBlock Text="提示：若显示“需要授权”，请戴上头显并点击“允许 USB 调试”；若频繁 offline，优先改用主板 USB 2.0 Type-A 口。" Foreground="{StaticResource TextDim}" Margin="0,10,0,0"/>
                </StackPanel>

                <StackPanel Grid.Row="1" Grid.Column="1" Margin="12,10,0,0">
                    <Border Padding="10,8" CornerRadius="8" BorderThickness="1"
                            Background="#F8FAFC" BorderBrush="#E2E8F0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <TextBlock x:Name="ApkInfoFileText" Grid.Row="0" Grid.Column="0" Text="文件：-" Foreground="{StaticResource TextDim}" Margin="0,0,10,4"/>
                            <TextBlock x:Name="ApkInfoSizeText" Grid.Row="0" Grid.Column="1" Text="大小：-" Foreground="{StaticResource TextDim}" Margin="0,0,0,4"/>
                            <TextBlock x:Name="ApkInfoPackageText" Grid.Row="1" Grid.Column="0" Text="包名：-" Foreground="{StaticResource TextDim}" Margin="0,0,10,0"/>
                            <TextBlock x:Name="ApkInfoVersionText" Grid.Row="1" Grid.Column="1" Text="版本：-" Foreground="{StaticResource TextDim}"/>
                        </Grid>
                    </Border>

                    <Border Margin="0,10,0,0" Padding="10,8" CornerRadius="8" BorderThickness="1"
                            Background="#F8FAFC" BorderBrush="#E2E8F0">
                        <StackPanel>
                            <TextBlock Text="安装参数" FontWeight="SemiBold" Margin="0,0,0,8"/>
                            <CheckBox x:Name="ReplaceInstallCheckBox" IsChecked="True" Content="覆盖安装 (-r)" Margin="0,0,0,8"
                                      ToolTip="保留应用数据并覆盖安装同包名应用。"/>
                            <CheckBox x:Name="AllowDowngradeCheckBox" Content="允许降级 (-d)" Margin="0,0,0,8"
                                      ToolTip="安装更低版本时需要勾选；通常用于回退版本。"/>
                            <CheckBox x:Name="AllowTestApkCheckBox" Content="允许测试包 (-t)"
                                      ToolTip="安装 testOnly APK 时需要勾选。"/>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="说明：覆盖安装会保留应用数据；降级用于装低版本；测试包用于 testOnly APK。"
                               Foreground="{StaticResource TextDim}" Margin="0,8,0,0" TextWrapping="Wrap"/>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Row="2" Style="{StaticResource CardBorder}" Margin="0,14,0,0">
            <StackPanel>
                <TextBlock Text="向头显输入文字" FontSize="14" FontWeight="SemiBold"/>
                <TextBlock Text="发送到 Quest 当前聚焦的输入框" Foreground="{StaticResource TextDim}" Margin="0,6,0,12"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="InputTextBox" Height="36" VerticalContentAlignment="Center" ToolTip="空格会自动处理，直接输入即可。"/>
                    <Button x:Name="SendTextButton" Grid.Column="1" Content="发送到头显" Margin="10,0,0,0" Click="SendText_Click" Style="{DynamicResource PrimaryButton}"/>
                </Grid>

                <TextBlock Text="示例：war thunder（空格会自动处理）。尽量避免很长或复杂符号。" Foreground="{StaticResource TextDim}" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <Border Grid.Row="3" Style="{StaticResource CardBorder}" Margin="0,14,0,0">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Stretch">
                    <TextBlock Text="日志" FontSize="14" FontWeight="SemiBold"/>
                    <TextBlock Text="   出现问题时，请点击“打开问题日志”并发送最新日志给作者。" Foreground="{StaticResource TextDim}" Margin="10,2,0,0"/>
                </StackPanel>

                <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,10">
                    <Button Content="跳转作者" Padding="12,6" Click="OpenAuthor_Click" Style="{DynamicResource FluentButton}" x:Name="AuthorButton" />
                    <Button Content="清空" Padding="12,6" Margin="8,0,0,0" Click="ClearLog_Click" Style="{DynamicResource FluentButton}" x:Name="ClearLogButton" />
                    <Button Content="复制全部" Padding="12,6" Margin="8,0,0,0" Click="CopyLog_Click" Style="{DynamicResource FluentButton}" x:Name="CopyLogButton" />
                </StackPanel>

                <TextBox x:Name="LogBox" IsReadOnly="True" TextWrapping="Wrap"
                         VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" AcceptsReturn="True" VerticalAlignment="Stretch" MinHeight="160" FontFamily="Consolas"/>
            </DockPanel>
        </Border>
    </Grid>
</Window>
